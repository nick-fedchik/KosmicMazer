--[[
================================================================================
KOSMICMAZER ‚Äî Loading Monitor
================================================================================

Purpose: Tracks and debugs the loading process
Version: 1.0

Features:
- Monitors player loading states
- Tracks character addition timing
- Provides periodic status reports
- Logs player removal events

API:
- None (self-contained monitoring service)

Calls to:
- Players service: GetPlayers(), PlayerAdded

Called from:
- Game initialization system

Events:
- Player.CharacterAdded: Monitors character loading
- Player.Parent property change: Tracks player removal

Dependencies:
- Players service

ChangeLog:
- Initial implementation for loading state tracking

================================================================================
]]

local Players = game:GetService("Players")

local loadingStates = {}

local function monitorPlayer(player)
    local startTime = tick()
    loadingStates[player.UserId] = {
        startTime = startTime,
        currentStep = "Started"
    }
    
    print("[Loading] üë§ –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≥—Ä–∞–≤—Ü—è:", player.Name)
    
    player.CharacterAdded:Connect(function(character)
        loadingStates[player.UserId].currentStep = "CharacterAdded"
        loadingStates[player.UserId].characterTime = tick()
        print("[Loading] ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å—Ç–≤–æ—Ä–µ–Ω–æ:", player.Name, "–ß–∞—Å:", loadingStates[player.UserId].characterTime - startTime, "—Å")
    end)
    
    player:GetPropertyChangedSignal("Parent"):Connect(function()
        if not player.Parent then
            loadingStates[player.UserId].currentStep = "PlayerRemoved"
            loadingStates[player.UserId].removeTime = tick()
            print("[Loading] üëã –ì—Ä–∞–≤–µ—Ü—å –≤–∏–π—à–æ–≤:", player.Name, "–ß–∞—Å:", loadingStates[player.UserId].removeTime - startTime, "—Å")
        end
    end)
end

-- Connect to player events
Players.PlayerAdded:Connect(monitorPlayer)

-- Handle existing players
for _, player in ipairs(Players:GetPlayers()) do
    monitorPlayer(player)
end

-- Periodic status report
task.spawn(function()
    while true do
        task.wait(5)
        print("[Loading] === –°—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ===")
        for userId, state in pairs(loadingStates) do
            local player = Players:GetPlayerByUserId(userId)
            if player then
                print("  -", player.Name, "–ö—Ä–æ–∫:", state.currentStep, "–ß–∞—Å:", tick() - state.startTime, "—Å")
            end
        end
    end
end)

print("[Loading] üöÄ –ú–æ–Ω—ñ—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–ø—É—â–µ–Ω–æ")