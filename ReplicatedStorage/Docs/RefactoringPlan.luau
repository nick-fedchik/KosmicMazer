--[[
================================================================================
KOSMICMAZER â€” Game Levels Refactoring Plan
================================================================================

Purpose: Unified structure for game locations, planets, and interaction objects
Version: 1.1

Current Problems:
- Mixed location management across multiple scripts
- No unified location manager system
- Inconsistent object registration and state management
- Hardcoded planet/space relationships
- No separation between location-specific and global objects
- No clear game environment switching system

Proposed New Structure:

1. ServerStorage Reorganization:
   ServerStorage/
   â”œâ”€â”€ Space/                        -- Space environment
   â”‚   â”œâ”€â”€ SpaceStation/             -- Space Station location
   â”‚   â”‚   â”œâ”€â”€ Models/               -- All station models
   â”‚   â”‚   â”‚   â”œâ”€â”€ SpawnLocation
   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetScanner
   â”‚   â”‚   â”‚   â”œâ”€â”€ TeleportationDevice
   â”‚   â”‚   â”‚   â””â”€â”€ ... (other station objects)
   â”‚   â”‚   â”œâ”€â”€ Scripts/              -- Station-specific scripts
   â”‚   â”‚   â”‚   â”œâ”€â”€ SpaceStationManager.lua
   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetScannerController.lua
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”œâ”€â”€ Lighting/             -- Station lighting
   â”‚   â”‚   â””â”€â”€ Configuration/        -- Station config
   â”‚   â””â”€â”€ Common/                   -- Shared space objects
   â”‚       â”œâ”€â”€ TeleportationDevice/  -- Global teleportation system
   â”‚       â”œâ”€â”€ Effects/              -- Space effects
   â”‚       â””â”€â”€ ...
   â”œâ”€â”€ Planets/                     -- All planet templates
   â”‚   â”œâ”€â”€ Planet_1/                -- First planet
   â”‚   â”‚   â”œâ”€â”€ PlanetModel/         -- Planet visual model
   â”‚   â”‚   â”œâ”€â”€ Lighting/            -- Planet-specific lighting
   â”‚   â”‚   â”œâ”€â”€ Locations/           -- Planet locations
   â”‚   â”‚   â”‚   â”œâ”€â”€ Location_1/      -- First location
   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Models/     -- Location models
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SpawnLocation
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InteractionObjects/
   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceNode_1
   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceNode_2
   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Scripts/    -- Location-specific scripts
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LocationManager.lua
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceController.lua
   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Lighting/   -- Location lighting
   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Configuration/
   â”‚   â”‚   â”‚   â”œâ”€â”€ Location_2/      -- Second location
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”œâ”€â”€ Scripts/             -- Planet-wide scripts
   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetManager.lua
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â””â”€â”€ Configuration/       -- Planet config
   â”‚   â””â”€â”€ Planet_2/               -- Second planet
   â”‚       â””â”€â”€ ...
   â”œâ”€â”€ Effects/                    -- Global effects (existing)
   â””â”€â”€ ...

2. New Manager Scripts Architecture:

   ServerScriptService/
   â”œâ”€â”€ GameWorldManager.lua          -- NEW: Main world controller
   â”‚   -- Manages loading/unloading of worlds
   â”‚   -- Coordinates between Space and Planet managers
   â”‚   -- Handles world transitions
   â”‚
   â”œâ”€â”€ LocationManager.lua           -- REFACTORED: Simplified location loader
   â”‚   -- Only handles physical loading/unloading
   â”‚   -- Delegates logic to specific location managers
   â”‚
   â”œâ”€â”€ SpaceStationManager.lua       -- NEW: Space Station controller
   â”‚   -- Manages station-specific objects
   â”‚   -- Handles station game rules
   â”‚   -- Registers/unregisters station objects
   â”‚
   â”œâ”€â”€ PlanetManager.lua             -- NEW: Planet controller
   â”‚   -- Manages planet-wide systems
   â”‚   -- Coordinates between planet locations
   â”‚   -- Handles planet-specific rules
   â”‚
   â””â”€â”€ LocationManagers/             -- NEW: Location-specific managers
       â”œâ”€â”€ BaseLocationManager.lua    -- Base class for all locations
       â”œâ”€â”€ Location_1_Manager.lua     -- Location 1 specific logic
       â”œâ”€â”€ Location_2_Manager.lua     -- Location 2 specific logic
       â””â”€â”€ ...

3. Configuration Structure:

   GameConfig.lua Enhanced:
   {
       Worlds = {
           Space = {
               Locations = {
                   SpaceStation = {
                       DisplayName = "ğŸš€ ĞšĞ¾ÑĞ¼Ñ–Ñ‡Ğ½Ğ° Ğ¡Ñ‚Ğ°Ğ½Ñ†Ñ–Ñ",
                       TemplatePath = "ServerStorage.Space.SpaceStation",
                       ManagerScript = "SpaceStationManager",
                       InteractionObjects = {
                           PlanetScanner = {
                               TemplatePath = "Models/PlanetScanner",
                               ControllerScript = "PlanetScannerController",
                               IsGlobal = false
                           },
                           TeleportationDevice = {
                               TemplatePath = "Common/TeleportationDevice",
                               ControllerScript = "TeleportationManager",
                               IsGlobal = true
                           }
                       },
                       GameRules = {
                           AllowScanning = true,
                           AllowTeleportation = true,
                           ...
                       }
                   }
               }
           },
           Planets = {
               Planet_1 = {
                   DisplayName = "Zalizyaka",
                   TemplatePath = "ServerStorage.Planets.Planet_1",
                   ManagerScript = "PlanetManager",
                   Locations = {
                       Location_1 = {
                           DisplayName = "Ğ¡Ğ°Ğ´Ğ¾Ñ‡Ğ¾Ğº",
                           TemplatePath = "Locations/Location_1",
                           ManagerScript = "Location_1_Manager",
                           InteractionObjects = {
                               ResourceNode_1 = {
                                   TemplatePath = "Models/InteractionObjects/ResourceNode_1",
                                   ControllerScript = "ResourceController",
                                   IsGlobal = false
                               }
                           },
                           GameRules = {
                               ResourceRegeneration = true,
                               MaxResources = 100,
                               ...
                           }
                       },
                       Location_2 = {
                           ...
                       }
                   }
               },
               Planet_2 = {
                   ...
               }
           }
       }
   }

4. Game Environment System:

   Game Environment (Ğ†Ğ³Ñ€Ğ¾Ğ²Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ) - Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ ÑĞ²Ñ–Ñ‚, Ğ² ÑĞºĞ¾Ğ¼Ñƒ Ğ¿ĞµÑ€ĞµĞ±ÑƒĞ²Ğ°Ñ” Ğ³Ñ€Ğ°Ğ²ĞµÑ†ÑŒ
   Ğ”Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ¸ Ñ–Ğ³Ñ€Ğ¾Ğ²Ğ¸Ñ… ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰:
   1) Space Environment (ĞšĞ¾ÑĞ¼Ñ–Ñ‡Ğ½Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ)
   2) Planet Environment (ĞŸĞ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ€Ğ½Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ)

   4.1 Space Environment Loading Process:
   1.1 Clear Workspace completely
   1.2 Copy from ServerStorage/Planets/Planet_N/ to Workspace:
       â”œâ”€â”€ PlanetModel/         -- Planet visual model
       â””â”€â”€ Lighting/*           -- Planet-specific lighting
   1.3 Copy from ServerStorage/Space/SpaceStation/ to Workspace:
       â”œâ”€â”€ Models/             -- All station models
       â”‚   â”œâ”€â”€ SpawnLocation
       â”‚   â”œâ”€â”€ PlanetScanner
       â”‚   â”œâ”€â”€ TeleportationDevice
       â”‚   â””â”€â”€ ... (other station objects)
       â”œâ”€â”€ Scripts/            -- Station-specific scripts
       â”œâ”€â”€ Lighting/           -- Station lighting
       â””â”€â”€ Configuration/      -- Station config

   4.2 Planet Environment Loading Process:
   1.1 Clear Workspace completely
   1.2 Copy from ServerStorage/Planets/Planet_N/Locations/Location_M/ to Workspace:
       â”œâ”€â”€ Models/             -- Location models
       â”‚   â”œâ”€â”€ SpawnLocation
       â”‚   â”œâ”€â”€ InteractionObjects/
       â”‚   â”‚   â”œâ”€â”€ ResourceNode_1
       â”‚   â”‚   â”œâ”€â”€ ResourceNode_2
       â”‚   â”‚   â””â”€â”€ ...
       â”œâ”€â”€ Scripts/            -- Location-specific scripts
       â”‚   â”œâ”€â”€ LocationManager.lua
       â”‚   â”œâ”€â”€ ResourceController.lua
       â”‚   â””â”€â”€ ...
       â”œâ”€â”€ Lighting/           -- Location lighting
       â””â”€â”€ Configuration/      -- Location config

   4.3 Environment Switching Logic:
   - GameWorldManager handles environment transitions
   - Each environment has its own loading/unloading sequence
   - Player state preserved during transitions
   - Smooth transitions with loading screens if needed

5. Refactoring Steps:

Phase 1: Structure Preparation
1. Create new ServerStorage/Space and ServerStorage/Planets structure
2. Move existing models to new locations
3. Create template folders for future content
4. Design environment loading/unloading system

Phase 2: Manager Scripts Creation
1. Create BaseLocationManager with common functionality
2. Create GameWorldManager as main coordinator with environment switching
3. Create SpaceStationManager and PlanetManager
4. Create location-specific managers
5. Create environment loading utilities

Phase 3: Configuration Enhancement
1. Enhance GameConfig with new structure
2. Add interaction objects configuration
3. Add game rules configuration

Phase 4: Script Migration
1. Migrate existing logic to new managers
2. Update LocationManager to use new structure
3. Update TeleportationManager to work with new system
4. Update ScannerService to work with new structure
5. Implement environment switching logic
6. Create workspace clearing and loading utilities

Phase 5: Testing and Validation
1. Test all location transitions
2. Test interaction objects in each location
3. Test game rules enforcement
4. Test object registration/unregistration
5. Test environment switching (Space â†” Planet)
6. Test workspace clearing and loading
7. Test player state preservation during transitions

Phase 6: Cleanup
1. Remove old structure
2. Clean up unused scripts
3. Update documentation

5. Key Benefits:
- Unified location management
- Clear separation of concerns
- Easy addition of new planets/locations
- Consistent object registration system
- Flexible game rules configuration
- Reusable interaction objects
- Better code organization
- Easier debugging and maintenance
- Clean environment switching system
- Proper workspace management
- Player state preservation

6. Implementation Notes:
- Each location manager handles its own object registry
- Global objects (like TeleportationDevice) are managed by their own controllers
- GameWorldManager coordinates between different world types
- Configuration-driven approach for easy content addition
- Backward compatibility during transition period
- Environment switching should be atomic (all-or-nothing)
- Workspace clearing must be complete to avoid conflicts
- Consider loading screens for smooth transitions

7. Environment Management Best Practices:
- Always clear Workspace before loading new environment
- Use WaitForChild() when accessing loaded objects
- Implement proper error handling for loading failures
- Cache frequently accessed objects for performance
- Use CollectionService tags for environment-specific objects
- Implement cleanup events for proper resource management
- Consider memory usage when loading large environments

================================================================================
]]