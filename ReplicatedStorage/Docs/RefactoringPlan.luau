--[[
================================================================================
KOSMICMAZER â€” Game Levels Refactoring Plan
================================================================================

Purpose: Unified structure for game locations, planets, and interaction objects
Version: 1.2
Last Updated: 2026-01-07

Current Problems:
- Mixed location management across multiple scripts
- No unified location manager system
- Inconsistent object registration and state management
- Hardcoded planet/space relationships
- No separation between location-specific and global objects
- No clear game environment switching system

Proposed New Structure:

1. ServerStorage Reorganization:
   ServerStorage/
   â”œâ”€â”€ Space/                        -- Folder: Space environment
   â”‚   â”œâ”€â”€ SpaceStation/             -- Folder: Space Station location
   â”‚   â”‚   â”œâ”€â”€ Models/               -- Folder: All station models
   â”‚   â”‚   â”‚   â”œâ”€â”€ SpawnLocation    -- SpawnLocation: Player spawn point
   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetScanner    -- Model: Planet scanning device
   â”‚   â”‚   â”‚   â”œâ”€â”€ TeleportationDevice -- Model: Teleportation interface
   â”‚   â”‚   â”‚   â””â”€â”€ ... (other station objects)
   â”‚   â”‚   â”œâ”€â”€ Scripts/              -- Folder: Station-specific scripts
   â”‚   â”‚   â”‚   â”œâ”€â”€ SpaceStationManager.lua -- ModuleScript: Station controller
   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetScannerController.lua -- ModuleScript: Scanner controller
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”œâ”€â”€ Lighting/             -- Folder: Station lighting
   â”‚   â”‚   â”‚   â”œâ”€â”€ Sky               -- Sky: Station skybox
   â”‚   â”‚   â”‚   â”œâ”€â”€ Atmosphere        -- Atmosphere: Station atmosphere
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â””â”€â”€ Configuration/        -- Folder: Station config
   â”‚   â”‚       â”œâ”€â”€ Settings.lua     -- ModuleScript: Station settings
   â”‚   â”‚       â””â”€â”€ ...
   â”‚   â””â”€â”€ Common/                   -- Folder: Shared space objects
   â”‚       â”œâ”€â”€ TeleportationDevice/  -- Folder: Global teleportation system
   â”‚       â”‚   â”œâ”€â”€ Device           -- Model: Teleport device model
   â”‚       â”‚   â””â”€â”€ ...
   â”‚       â”œâ”€â”€ Effects/              -- Folder: Space effects
   â”‚       â”‚   â”œâ”€â”€ Particles         -- Folder: Particle effects
   â”‚       â”‚   â””â”€â”€ ...
   â”‚       â””â”€â”€ ...
   â”œâ”€â”€ Planets/                     -- Folder: All planet templates
   â”‚   â”œâ”€â”€ Planet_1/                -- Folder: First planet
   â”‚   â”‚   â”œâ”€â”€ PlanetModel          -- Folder: Planet visual model
   â”‚   â”‚   â”‚   â””â”€â”€ Planet           -- Model: Planet sphere with atmosphere
   â”‚   â”‚   â”œâ”€â”€ Lighting/            -- Folder: Planet-specific lighting
   â”‚   â”‚   â”‚   â”œâ”€â”€ Sky               -- Sky: Planet skybox
   â”‚   â”‚   â”‚   â”œâ”€â”€ Atmosphere        -- Atmosphere: Planet atmosphere
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”œâ”€â”€ Locations/           -- Folder: Planet locations
   â”‚   â”‚   â”‚   â”œâ”€â”€ Location_1/      -- Folder: First location
   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Models/     -- Folder: Location models
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SpawnLocation -- SpawnLocation: Player spawn point
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Baseplate -- Part: Ground/floor
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InteractionObjects/ -- Folder: Interactive objects
   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceNode_1 -- Part: Resource node with effects
   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceNode_2 -- Part: Resource node with effects
   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Scripts/    -- Folder: Location-specific scripts
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LocationManager.lua -- ModuleScript: Location controller
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceController.lua -- ModuleScript: Resource manager
   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Lighting/   -- Folder: Location lighting
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sky       -- Sky: Location skybox
   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LightSources -- Folder: Light sources
   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Configuration/ -- Folder: Location config
   â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Settings.lua -- ModuleScript: Location settings
   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ...
   â”‚   â”‚   â”‚   â”œâ”€â”€ Location_2/      -- Folder: Second location
   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ... (same structure as Location_1)
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â”œâ”€â”€ Scripts/             -- Folder: Planet-wide scripts
   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetManager.lua -- ModuleScript: Planet controller
   â”‚   â”‚   â”‚   â””â”€â”€ ...
   â”‚   â”‚   â””â”€â”€ Configuration/       -- Folder: Planet config
   â”‚   â”‚       â”œâ”€â”€ Settings.lua     -- ModuleScript: Planet settings
   â”‚   â”‚       â””â”€â”€ ...
   â”‚   â””â”€â”€ Planet_2/               -- Folder: Second planet
   â”‚       â””â”€â”€ ... (same structure as Planet_1)
   â”œâ”€â”€ Effects/                    -- Folder: Global effects (existing)
   â”‚   â”œâ”€â”€ TeleportAnimation/      -- Folder: Teleport effects
   â”‚   â”‚   â””â”€â”€ TeleportParticle     -- ParticleEmitter: Teleport effect
   â”‚   â””â”€â”€ ...
   â””â”€â”€ ...

2. New Manager Scripts Architecture:

   ServerScriptService/
   â”œâ”€â”€ GameWorldManager.lua          -- NEW: Main world controller
   â”‚   -- Manages loading/unloading of worlds
   â”‚   -- Coordinates between Space and Planet managers
   â”‚   -- Handles world transitions
   â”‚
   â”œâ”€â”€ LocationManager.lua           -- REFACTORED: Simplified location loader
   â”‚   -- Only handles physical loading/unloading
   â”‚   -- Delegates logic to specific location managers
   â”‚
   â”œâ”€â”€ SpaceStationManager.lua       -- NEW: Space Station controller
   â”‚   -- Manages station-specific objects
   â”‚   -- Handles station game rules
   â”‚   -- Registers/unregisters station objects
   â”‚
   â”œâ”€â”€ PlanetManager.lua             -- NEW: Planet controller
   â”‚   -- Manages planet-wide systems
   â”‚   -- Coordinates between planet locations
   â”‚   -- Handles planet-specific rules
   â”‚
   â””â”€â”€ LocationManagers/             -- NEW: Location-specific managers
       â”œâ”€â”€ BaseLocationManager.lua    -- Base class for all locations
       â”œâ”€â”€ Location_1_Manager.lua     -- Location 1 specific logic
       â”œâ”€â”€ Location_2_Manager.lua     -- Location 2 specific logic
       â””â”€â”€ ...

3. Configuration Structure:

   GameConfig.lua Enhanced:
   {
       Worlds = {
           Space = {
               Locations = {
                   SpaceStation = {
                       DisplayName = "ğŸš€ ĞšĞ¾ÑĞ¼Ñ–Ñ‡Ğ½Ğ° Ğ¡Ñ‚Ğ°Ğ½Ñ†Ñ–Ñ",
                       TemplatePath = "ServerStorage.Space.SpaceStation",
                       ManagerScript = "SpaceStationManager",
                       InteractionObjects = {
                           PlanetScanner = {
                               TemplatePath = "Models/PlanetScanner",
                               ControllerScript = "PlanetScannerController",
                               IsGlobal = false
                           },
                           TeleportationDevice = {
                               TemplatePath = "Common/TeleportationDevice",
                               ControllerScript = "TeleportationManager",
                               IsGlobal = true
                           }
                       },
                       GameRules = {
                           AllowScanning = true,
                           AllowTeleportation = true,
                           ...
                       }
                   }
               }
           },
           Planets = {
               Planet_1 = {
                   DisplayName = "Zalizyaka",
                   TemplatePath = "ServerStorage.Planets.Planet_1",
                   ManagerScript = "PlanetManager",
                   Locations = {
                       Location_1 = {
                           DisplayName = "Ğ¡Ğ°Ğ´Ğ¾Ñ‡Ğ¾Ğº",
                           TemplatePath = "Locations/Location_1",
                           ManagerScript = "Location_1_Manager",
                           InteractionObjects = {
                               ResourceNode_1 = {
                                   TemplatePath = "Models/InteractionObjects/ResourceNode_1",
                                   ControllerScript = "ResourceController",
                                   IsGlobal = false
                               }
                           },
                           GameRules = {
                               ResourceRegeneration = true,
                               MaxResources = 100,
                               ...
                           }
                       },
                       Location_2 = {
                           ...
                       }
                   }
               },
               Planet_2 = {
                   ...
               }
           }
       }
   }

4. Game Environment System:

   Game Environment (Ğ†Ğ³Ñ€Ğ¾Ğ²Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ) - Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ ÑĞ²Ñ–Ñ‚, Ğ² ÑĞºĞ¾Ğ¼Ñƒ Ğ¿ĞµÑ€ĞµĞ±ÑƒĞ²Ğ°Ñ” Ğ³Ñ€Ğ°Ğ²ĞµÑ†ÑŒ
   Ğ”Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ¸ Ñ–Ğ³Ñ€Ğ¾Ğ²Ğ¸Ñ… ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰:
   1) Space Environment (ĞšĞ¾ÑĞ¼Ñ–Ñ‡Ğ½Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ)
   2) Planet Environment (ĞŸĞ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ€Ğ½Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ)

   Ğ’ĞĞ–Ğ›Ğ˜Ğ’Ğ: ĞĞ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ‰ĞµĞ½Ğ½Ñ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ–Ğ² Ğ² Roblox:
   =========================================
   - Script (.server.luau) â†’ Ğ²Ğ¸ĞºĞ¾Ğ½ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ñ–
   - LocalScript (.client.luau) â†’ Ğ²Ğ¸ĞºĞ¾Ğ½ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜ Ğ½Ğ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–
   - ModuleScript (.luau) â†’ Ğ¼Ğ¾Ğ¶Ğµ require Ğ· Ğ¾Ğ±Ğ¾Ñ… ÑÑ‚Ğ¾Ñ€Ñ–Ğ½

   LocalScript Ğ¿Ñ€Ğ°Ñ†ÑÑ” Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜ Ğ²:
   - StarterPlayerScripts, StarterGui, PlayerGui
   - StarterCharacterScripts, ReplicatedFirst

   LocalScript ĞĞ• Ğ¿Ñ€Ğ°Ñ†ÑÑ” Ğ²:
   - Workspace (Ñ–Ğ³Ğ½Ğ¾Ñ€ÑƒÑ”Ñ‚ÑŒÑÑ!)
   - ServerStorage, ServerScriptService

   Ğ¢Ğ¾Ğ¼Ñƒ Scripts/ Ñ€Ğ¾Ğ·Ğ´Ñ–Ğ»ĞµĞ½Ğ¾ Ğ½Ğ° Server/ Ñ‚Ğ° Client/:
   Scripts/
   â”œâ”€â”€ Server/           -- ĞšĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ñ‚Ğ¸ Ğ² Workspace Ğ°Ğ±Ğ¾ require
   â”‚   â”œâ”€â”€ *.luau        -- ModuleScripts (require Ğ· ServerScriptService)
   â”‚   â””â”€â”€ *.server.luau -- Scripts (ĞºĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ñ‚Ğ¸ Ğ² Workspace)
   â””â”€â”€ Client/           -- ĞšĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ñ‚Ğ¸ Ğ² StarterPlayerScripts/StarterGui
       â””â”€â”€ *.client.luau -- LocalScripts (Ğ²Ğ¸ĞºĞ¾Ğ½ÑƒÑÑ‚ÑŒÑÑ Ğ½Ğ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–)

   4.1 Space Environment Loading Process:
   1.1 Clear Workspace completely
   1.2 Remove previous location's Client scripts from StarterPlayerScripts
   1.3 Copy from ServerStorage/Planets/Planet_N/ to Workspace:
       â”œâ”€â”€ PlanetModel/         -- Folder: Planet visual model
       â”‚   â””â”€â”€ Planet           -- Model: Planet sphere with atmosphere
       â””â”€â”€ Lighting/*           -- Folder: Planet-specific lighting
   1.4 Copy from ServerStorage/Space/SpaceStation/ to Workspace:
       â”œâ”€â”€ Models/             -- Folder: All station models â†’ Workspace
       â”‚   â”œâ”€â”€ SpawnLocation, PlanetScanner, TeleportationDevice, ...
       â””â”€â”€ Lighting/           -- Folder: Station lighting
   1.5 Process Scripts/Server/:
       - ModuleScripts: require from original location OR clone to Workspace
       - Scripts (.server.luau): clone to Workspace (will execute automatically)
   1.6 Process Scripts/Client/:
       - LocalScripts (.client.luau): clone to StarterPlayerScripts
       - For each active player: clone to player.PlayerScripts
   1.7 Load Configuration/
   1.8 Verify all objects loaded
   1.9 Spawn player at SpawnLocation

   4.2 Planet Environment Loading Process:
   1.1 Clear Workspace completely
   1.2 Remove previous location's Client scripts from StarterPlayerScripts
   1.3 Copy from ServerStorage/Planets/Planet_N/Locations/Location_M/ to Workspace:
       â”œâ”€â”€ Models/             -- Folder: Location models â†’ Workspace
       â”‚   â”œâ”€â”€ SpawnLocation    -- SpawnLocation: Player spawn point
       â”‚   â”œâ”€â”€ Baseplate        -- Part: Ground/floor
       â”‚   â”œâ”€â”€ InteractionObjects/ -- Folder: Interactive objects
       â”‚   â””â”€â”€ ...
       â””â”€â”€ Lighting/           -- Folder: Location lighting
   1.4 Process Scripts/Server/:
       - ModuleScripts: require from original location OR clone to Workspace
       - Scripts (.server.luau): clone to Workspace (will execute automatically)
   1.5 Process Scripts/Client/:
       - LocalScripts (.client.luau): clone to StarterPlayerScripts
       - For each active player: clone to player.PlayerScripts
   1.6 Load Configuration/
   1.7 Verify all objects loaded
   1.8 Spawn player at SpawnLocation

   4.3 Environment Switching Logic:
   - GameWorldManager handles environment transitions
   - Each environment has its own loading/unloading sequence
   - Player state preserved during transitions
   - Smooth transitions with loading screens if needed

5. Refactoring Steps:

Phase 1: Structure Preparation
1. Create new ServerStorage/Space and ServerStorage/Planets structure
2. Move existing models to new locations
3. Create template folders for future content
4. Design environment loading/unloading system

Phase 2: Manager Scripts Creation
1. Create BaseLocationManager with common functionality
2. Create GameWorldManager as main coordinator with environment switching
3. Create SpaceStationManager and PlanetManager
4. Create location-specific managers
5. Create environment loading utilities

Phase 3: Configuration Enhancement
1. Enhance GameConfig with new structure
2. Add interaction objects configuration
3. Add game rules configuration

Phase 4: Script Migration
1. Migrate existing logic to new managers
2. Update LocationManager to use new structure
3. Update TeleportationManager to work with new system
4. Update ScannerService to work with new structure
5. Implement environment switching logic
6. Create workspace clearing and loading utilities

Phase 5: Testing and Validation
1. Test all location transitions
2. Test interaction objects in each location
3. Test game rules enforcement
4. Test object registration/unregistration
5. Test environment switching (Space â†” Planet)
6. Test workspace clearing and loading
7. Test player state preservation during transitions

Phase 6: Cleanup
1. Remove old structure
2. Clean up unused scripts
3. Update documentation

5. Key Benefits:
- Unified location management
- Clear separation of concerns
- Easy addition of new planets/locations
- Consistent object registration system
- Flexible game rules configuration
- Reusable interaction objects
- Better code organization
- Easier debugging and maintenance
- Clean environment switching system
- Proper workspace management
- Player state preservation

6. Implementation Notes:
- Each location manager handles its own object registry
- Global objects (like TeleportationDevice) are managed by their own controllers
- GameWorldManager coordinates between different world types
- Configuration-driven approach for easy content addition
- Backward compatibility during transition period
- Environment switching should be atomic (all-or-nothing)
- Workspace clearing must be complete to avoid conflicts
- Consider loading screens for smooth transitions

7. Environment Management Best Practices:
- Always clear Workspace before loading new environment
- Use WaitForChild() when accessing loaded objects
- Implement proper error handling for loading failures
- Cache frequently accessed objects for performance
- Use CollectionService tags for environment-specific objects
- Implement cleanup events for proper resource management
- Consider memory usage when loading large environments

================================================================================
]]