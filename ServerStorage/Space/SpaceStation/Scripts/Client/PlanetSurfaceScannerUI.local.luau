--[[
================================================================================
KOSMICMAZER ‚Äî Planet Surface Scanner UI Client
================================================================================

Purpose: –°—Ç–≤–æ—Ä—é—î —Ç–∞ –∫–µ—Ä—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —Å–∫–∞–Ω–µ—Ä–∞ –ø–ª–∞–Ω–µ—Ç–Ω–æ—ó –ø–æ–≤–µ—Ä—Ö–Ω—ñ –∑–≥—ñ–¥–Ω–æ GuiConvention
Version: 2.0

Features:
- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–ª–∞–Ω–µ—Ç–Ω–æ—ó –ø–æ–≤–µ—Ä—Ö–Ω—ñ (Windows 95 —Å—Ç–∏–ª—å)
- –ê–Ω—ñ–º–æ–≤–∞–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑ –ø—Ä–æ–≥—Ä–µ—Å –±–∞—Ä–æ–º
- –°–ø–∏—Å–æ–∫ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –ª–æ–∫–∞—Ü—ñ–π –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
- 3D –µ—Ñ–µ–∫—Ç–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∑–≥—ñ–¥–Ω–æ GuiConvention
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ ProximityPrompt –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Å–∫–∞–Ω–µ—Ä–∞
- –ê–Ω—ñ–º–∞—Ü—ñ—ó –∑ TweenService (Back.Out, Quad.In, Linear)
- LocationModel hierarchical structure support

API:
- Initialize(scannerModel): –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î UI –¥–ª—è –º–æ–¥–µ–ª—ñ —Å–∫–∞–Ω–µ—Ä–∞
- ShowScanResults(results): –ü–æ–∫–∞–∑—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
- ShowScanningAnimation(): –ü–æ–∫–∞–∑—É—î –∞–Ω—ñ–º–∞—Ü—ñ—é —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
- HideScanningAnimation(): –•–æ–≤–∞—î –∞–Ω—ñ–º–∞—Ü—ñ—é —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è

Calls to:
- Players: –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- StarterGui: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è GUI –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
- TweenService: –ê–Ω—ñ–º–∞—Ü—ñ—ó –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤
- ProximityPrompt: –í–∏—è–≤–ª–µ–Ω–Ω—è –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –≥—Ä–∞–≤—Ü—è

Called from:
- PlanetSurfaceScanner: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ

Events:
- ScanStarted: –ü–æ—á–∞—Ç–æ–∫ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
- ScanCompleted: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
- LocationSelected: –í–∏–±—ñ—Ä –ª–æ–∫–∞—Ü—ñ—ó –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

Dependencies:
- GuiConvention: –ö–æ–ª—å–æ—Ä–∏ WIN95_COLORS —Ç–∞ NOTIFICATION_COLORS (defined locally)
- TweenService: –ê–Ω—ñ–º–∞—Ü—ñ—ó
- PlanetSurfaceScanner: –ú–æ–¥–µ–ª—å —Å–∫–∞–Ω–µ—Ä–∞

ChangeLog:
- Version 2.0 (2026-01-10): IMPROVED Scanner UI - simplified location list
  - Removed teleport button, type, and difficulty fields
  - Now uses DisplayName from server (fixed "–ù–µ–≤—ñ–¥–æ–º–∞ –ª–æ–∫–∞—Ü—ñ—è" bug)
  - Added "–ù–û–í–ê" status badge for unvisited locations (green badge)
  - Reduced frame height from 60px to 40px for compact display
  - Location list is now read-only (no click interactions)
- Version 2.0: Use ScanResults planetName for UI display (2026-01-10)
- Version 1.7: Removed GuiConvention dependency, colors defined locally
- Version 1.6: Renamed from ScannerUI to PlanetSurfaceScannerUI for clarity
- Version 1.5: Simplified Initialize() - removed mock results simulation
- Version 1.5: Flattened validation logic without complex nesting
- Version 1.4: Updated for LocationModel hierarchical structure (ETAP 3)
- Version 1.4: Auto-initialization now searches for LocationModel with attributes
- Version 1.4: Added LocationModel attribute validation (LocationId=SpaceStation, LocationType=Space)
- Version 1.4: Scanner search updated to LocationModel.Equipment.PlanetSurfaceScanner
- Version 1.3: Enhanced error messages and diagnostics for new structure
- Version 1.2: Removed GameConfig dependency, using local constants
- Version 1.1: Added scanning animation with progress bar

================================================================================
]]

local scriptVersion = "2.0"

--============================================================================--
--============================================================================--
-- SERVICES
--============================================================================--
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

--============================================================================--
-- MODULES
--============================================================================--
-- (No external modules required)

--============================================================================--
-- –ö–û–ù–°–¢–ê–ù–¢–ò / CONSTANTS
--============================================================================--

-- @const number –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
local SCAN_DURATION = 5

-- @const number –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
local MAX_RESULTS = 10

-- @const table –ö–æ–ª—å–æ—Ä–∏ Windows 95 (–ª–æ–∫–∞–ª—å–Ω–æ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ)
local WIN95_COLORS = {
    WindowBackground = Color3.fromRGB(192, 192, 192),  -- Light gray
    ButtonHighlight = Color3.fromRGB(255, 255, 255),   -- White
    ButtonShadow = Color3.fromRGB(128, 128, 128),      -- Dark gray
    ButtonDarkShadow = Color3.fromRGB(64, 64, 64),     -- Very dark gray
    TitleBarActive = Color3.fromRGB(0, 0, 128),        -- Dark blue
    TitleText = Color3.fromRGB(255, 255, 255),         -- White
    ButtonFace = Color3.fromRGB(192, 192, 192),        -- Light gray
    WindowText = Color3.fromRGB(0, 0, 0),              -- Black
}

-- @const table –ö–æ–ª—å–æ—Ä–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å (–ª–æ–∫–∞–ª—å–Ω–æ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ)
local NOTIFICATION_COLORS = {
    Success = Color3.fromRGB(39, 174, 96),    -- Green
    Error = Color3.fromRGB(231, 76, 60),      -- Red
    Warning = Color3.fromRGB(241, 196, 15),   -- Yellow
    Info = Color3.fromRGB(52, 152, 219),      -- Blue
}

-- @const number –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å UI –∞–Ω—ñ–º–∞—Ü—ñ–π
local UI_ANIMATION_DURATION = 0.3


--============================================================================--
-- –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü / GLOBAL VARIABLES
--============================================================================--

-- @var Player –õ–æ–∫–∞–ª—å–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å
local player = Players.LocalPlayer

-- @var ScreenGui? –ì–æ–ª–æ–≤–Ω–∏–π GUI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
local scannerGui = nil

-- @var Frame? –í—ñ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
local resultsWindow = nil

-- @var Frame? –í—ñ–∫–Ω–æ –∞–Ω—ñ–º–∞—Ü—ñ—ó —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
local scanningWindow = nil

-- @var Model? –ú–æ–¥–µ–ª—å —Å–∫–∞–Ω–µ—Ä–∞
local scannerModel = nil

-- @var ProximityPrompt? –ü—Ä–æ–º–ø—Ç –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Å–∫–∞–Ω–µ—Ä–∞
local proximityPrompt = nil

-- @var boolean –ß–∏ —Ç—Ä–∏–≤–∞—î —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
local isScanning = false

-- @var string? ??????? ????? ??????? ? ScanResults
local lastPlanetName = nil

--============================================================================--
-- –ü–£–ë–õ–Ü–ß–ù–ï API / PUBLIC API
--============================================================================--

-- @var table PlanetSurfaceScannerUI API
local PlanetSurfaceScannerUI = {}

--============================================================================--
-- –õ–û–ö–ê–õ–¨–ù–Ü –§–£–ù–ö–¶–Ü–á / LOCAL FUNCTIONS
--============================================================================--

local function updateScannerDisplayPlanetName(planetName: string)
	local scannerScreen = scannerModel and scannerModel:FindFirstChild("ScannerScreen")
	if not scannerScreen then return end

	local scanIndicator = scannerScreen:FindFirstChild("ScanIndicator")
	if not scanIndicator then return end

	local indicatorFrame = scanIndicator:FindFirstChild("IndicatorFrame")
	if not indicatorFrame then return end

	local scanLabel = indicatorFrame:FindFirstChild("ScanLabel")
	if not scanLabel then return end

	local displayName = planetName or "..."
	scanLabel.Text = "Planet: " .. displayName
	scanLabel.TextColor3 = Color3.new(0.8, 0.8, 1)
	scanLabel.BackgroundTransparency = 0.5
	scanIndicator.Enabled = true
	print("[PlanetSurfaceScannerUI 2.0] Set planet name on scan: " .. displayName)
end

--============================================================================--
-- REMOTEEVENT SUBSCRIPTION (v2.0)
--============================================================================--

local scanResultsEvent = ReplicatedStorage:FindFirstChild("PlanetSurfaceScanner_Results")
if scanResultsEvent and scanResultsEvent:IsA("RemoteEvent") then
	scanResultsEvent.OnClientEvent:Connect(function(eventType, data)
		if eventType == "ScanResults" and type(data) == "table" then
			lastPlanetName = data.planetName or "Unknown planet"
			updateScannerDisplayPlanetName(lastPlanetName)
			print("[PlanetSurfaceScannerUI 2.0] ScanResults received from server: ", lastPlanetName)
			PlanetSurfaceScannerUI.ShowScanResults(data.locations or {})
		end
	end)
else
	warn("[PlanetSurfaceScannerUI 2.0] RemoteEvent PlanetSurfaceScanner_Results not found in ReplicatedStorage")
end


-- –°—Ç–≤–æ—Ä—é—î 3D –µ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ (Windows 95 —Å—Ç–∏–ª—å)
-- @param button TextButton - –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó
-- @param raised boolean - –ß–∏ –∫–Ω–æ–ø–∫–∞ "–ø—ñ–¥–Ω—è—Ç–∞"
local function create3DEffect(button: TextButton, raised: boolean)
	if raised then
		button.BorderSizePixel = 2
		button.BorderColor3 = WIN95_COLORS.ButtonHighlight
		-- –°—Ç–≤–æ—Ä—é—î–º–æ —Å–≤—ñ—Ç–ª—É —Ä–∞–º–∫—É –∑–≤–µ—Ä—Ö—É/–∑–ª—ñ–≤–∞
		local lightBorder = Instance.new("Frame")
		lightBorder.Name = "LightBorder"
		lightBorder.Size = UDim2.new(1, 2, 1, 2)
		lightBorder.Position = UDim2.new(0, -1, 0, -1)
		lightBorder.BackgroundColor3 = WIN95_COLORS.ButtonHighlight
		lightBorder.BorderSizePixel = 0
		lightBorder.ZIndex = button.ZIndex + 1
		lightBorder.Parent = button

		-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ–º–Ω—É —Ä–∞–º–∫—É –∑–Ω–∏–∑—É/—Å–ø—Ä–∞–≤–∞
		local darkBorder = Instance.new("Frame")
		darkBorder.Name = "DarkBorder"
		darkBorder.Size = UDim2.new(1, 2, 1, 2)
		darkBorder.Position = UDim2.new(0, 1, 0, 1)
		darkBorder.BackgroundColor3 = WIN95_COLORS.ButtonShadow
		darkBorder.BorderSizePixel = 0
		darkBorder.ZIndex = button.ZIndex + 1
		darkBorder.Parent = button
	else
		button.BorderSizePixel = 2
		button.BorderColor3 = WIN95_COLORS.ButtonDarkShadow
		-- –í–∏–¥–∞–ª—è—î–º–æ 3D –µ—Ñ–µ–∫—Ç–∏
		local lightBorder = button:FindFirstChild("LightBorder")
		if lightBorder then lightBorder:Destroy() end
		local darkBorder = button:FindFirstChild("DarkBorder")
		if darkBorder then darkBorder:Destroy() end
	end
end

-- –°—Ç–≤–æ—Ä—é—î –≤—ñ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
local function createResultsWindow()
	if resultsWindow then
		resultsWindow:Destroy()
	end

	resultsWindow = Instance.new("Frame")
	resultsWindow.Name = "ScanResultsWindow"
	resultsWindow.Size = UDim2.new(0, 400, 0, 300)
	resultsWindow.Position = UDim2.new(0.5, -200, 0.5, -150)
	resultsWindow.BackgroundColor3 = WIN95_COLORS.WindowBackground
	resultsWindow.BorderSizePixel = 0
	resultsWindow.Parent = scannerGui

	-- Title bar
	local titleBar = Instance.new("Frame")
	titleBar.Name = "TitleBar"
	titleBar.Size = UDim2.new(1, 0, 0, 20)
	titleBar.Position = UDim2.new(0, 0, 0, 0)
	titleBar.BackgroundColor3 = WIN95_COLORS.TitleBarActive
	titleBar.BorderSizePixel = 0
	titleBar.Parent = resultsWindow

	-- Title text
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "TitleLabel"
	titleLabel.Size = UDim2.new(1, -60, 1, 0)
	titleLabel.Position = UDim2.new(0, 5, 0, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ–≤–µ—Ä—Ö–Ω—ñ"
	titleLabel.TextColor3 = WIN95_COLORS.TitleText
	titleLabel.Font = Enum.Font.SourceSansBold
	titleLabel.TextSize = 12
	titleLabel.Parent = titleBar

	-- Close button
	local closeBtn = Instance.new("TextButton")
	closeBtn.Name = "CloseBtn"
	closeBtn.Size = UDim2.new(0, 16, 0, 14)
	closeBtn.Position = UDim2.new(1, -18, 0, 3)
	closeBtn.BackgroundColor3 = WIN95_COLORS.ButtonFace
	closeBtn.BorderSizePixel = 1
	closeBtn.Text = "X"
	closeBtn.Font = Enum.Font.SourceSans
	closeBtn.TextSize = 10
	closeBtn.Parent = titleBar
	create3DEffect(closeBtn, true)

	-- Content area
	local content = Instance.new("Frame")
	content.Name = "Content"
	content.Size = UDim2.new(1, -4, 1, -44)
	content.Position = UDim2.new(0, 2, 0, 22)
	content.BackgroundTransparency = 1
	content.Parent = resultsWindow

	-- Results list
	local resultsList = Instance.new("ScrollingFrame")
	resultsList.Name = "ResultsList"
	resultsList.Size = UDim2.new(1, -10, 1, -10)
	resultsList.Position = UDim2.new(0, 5, 0, 5)
	resultsList.BackgroundColor3 = WIN95_COLORS.WindowBackground
	resultsList.BorderSizePixel = 1
	resultsList.BorderColor3 = WIN95_COLORS.ButtonShadow
	resultsList.ScrollBarThickness = 12
	resultsList.Parent = content

	-- Button container
	local buttonContainer = Instance.new("Frame")
	buttonContainer.Name = "ButtonContainer"
	buttonContainer.Size = UDim2.new(1, -4, 0, 30)
	buttonContainer.Position = UDim2.new(0, 2, 1, -32)
	buttonContainer.BackgroundTransparency = 1
	buttonContainer.Parent = resultsWindow

	-- Rescan button
	local rescanBtn = Instance.new("TextButton")
	rescanBtn.Name = "RescanBtn"
	rescanBtn.Size = UDim2.new(0, 100, 1, 0)
	rescanBtn.Position = UDim2.new(0, 5, 0, 0)
	rescanBtn.BackgroundColor3 = WIN95_COLORS.ButtonFace
	rescanBtn.BorderSizePixel = 1
	rescanBtn.Text = "–ü–µ—Ä–µ—Å–∫–∞–Ω–æ–≤–∞—Ç–∏"
	rescanBtn.Font = Enum.Font.SourceSans
	rescanBtn.TextSize = 12
	rescanBtn.Parent = buttonContainer
	create3DEffect(rescanBtn, true)

	-- Close button
	local closeBtn2 = Instance.new("TextButton")
	closeBtn2.Name = "CloseBtn2"
	closeBtn2.Size = UDim2.new(0, 80, 1, 0)
	closeBtn2.Position = UDim2.new(1, -85, 0, 0)
	closeBtn2.BackgroundColor3 = WIN95_COLORS.ButtonFace
	closeBtn2.BorderSizePixel = 1
	closeBtn2.Text = "–ó–∞–∫—Ä–∏—Ç–∏"
	closeBtn2.Font = Enum.Font.SourceSans
	closeBtn2.TextSize = 12
	closeBtn2.Parent = buttonContainer
	create3DEffect(closeBtn2, true)

	-- –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
	resultsWindow.Size = UDim2.new(0, 0, 0, 0)
	local tweenIn = TweenService:Create(resultsWindow, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 400, 0, 300)
	})
	tweenIn:Play()

	-- –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
	closeBtn.MouseButton1Click:Connect(function()
		local tweenOut = TweenService:Create(resultsWindow, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			Size = UDim2.new(0, 0, 0, 0)
		})
		tweenOut:Play()
		tweenOut.Completed:Wait()
		resultsWindow:Destroy()
		resultsWindow = nil
	end)

	closeBtn2.MouseButton1Click:Connect(function()
		local tweenOut = TweenService:Create(resultsWindow, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			Size = UDim2.new(0, 0, 0, 0)
		})
		tweenOut:Play()
		tweenOut.Completed:Wait()
		resultsWindow:Destroy()
		resultsWindow = nil
	end)

	rescanBtn.MouseButton1Click:Connect(function()
		if resultsWindow then
			resultsWindow:Destroy()
			resultsWindow = nil
		end
		PlanetSurfaceScannerUI.ShowScanningAnimation()
		task.delay(SCAN_DURATION, function()
			PlanetSurfaceScannerUI.HideScanningAnimation()
			print("[PlanetSurfaceScannerUI 2.0] Rescan completed, waiting for server results")
		end)
	end)

	-- –ï—Ñ–µ–∫—Ç–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –¥–ª—è –∫–Ω–æ–ø–æ–∫
	local function createButtonEffect(button)
		button.MouseEnter:Connect(function()
			create3DEffect(button, false)
		end)
		button.MouseLeave:Connect(function()
			create3DEffect(button, true)
		end)
		button.MouseButton1Down:Connect(function()
			create3DEffect(button, false)
		end)
		button.MouseButton1Up:Connect(function()
			create3DEffect(button, true)
		end)
	end

	createButtonEffect(closeBtn)
	createButtonEffect(closeBtn2)
	createButtonEffect(rescanBtn)

	return resultsList
end

-- –°—Ç–≤–æ—Ä—é—î –≤—ñ–∫–Ω–æ –∞–Ω—ñ–º–∞—Ü—ñ—ó —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
local function createScanningWindow()
	if scanningWindow then
		scanningWindow:Destroy()
	end

	scanningWindow = Instance.new("Frame")
	scanningWindow.Name = "ScanningWindow"
	scanningWindow.Size = UDim2.new(0, 300, 0, 150)
	scanningWindow.Position = UDim2.new(0.5, -150, 0.5, -75)
	scanningWindow.BackgroundColor3 = WIN95_COLORS.WindowBackground
	scanningWindow.BorderSizePixel = 0
	scanningWindow.Parent = scannerGui

	-- Title bar
	local titleBar = Instance.new("Frame")
	titleBar.Name = "TitleBar"
	titleBar.Size = UDim2.new(1, 0, 0, 20)
	titleBar.Position = UDim2.new(0, 0, 0, 0)
	titleBar.BackgroundColor3 = WIN95_COLORS.TitleBarActive
	titleBar.BorderSizePixel = 0
	titleBar.Parent = scanningWindow

	-- Title text
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "TitleLabel"
	titleLabel.Size = UDim2.new(1, -60, 1, 0)
	titleLabel.Position = UDim2.new(0, 5, 0, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = "–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ–≤–µ—Ä—Ö–Ω—ñ..."
	titleLabel.TextColor3 = WIN95_COLORS.TitleText
	titleLabel.Font = Enum.Font.SourceSansBold
	titleLabel.TextSize = 12
	titleLabel.Parent = titleBar

	-- Content area
	local content = Instance.new("Frame")
	content.Name = "Content"
	content.Size = UDim2.new(1, -4, 1, -44)
	content.Position = UDim2.new(0, 2, 0, 22)
	content.BackgroundTransparency = 1
	content.Parent = scanningWindow

	-- Scanning animation
	local scanningIcon = Instance.new("TextLabel")
	scanningIcon.Name = "ScanningIcon"
	scanningIcon.Size = UDim2.new(0, 50, 0, 50)
	scanningIcon.Position = UDim2.new(0.5, -25, 0, 10)
	scanningIcon.BackgroundColor3 = WIN95_COLORS.WindowBackground
	scanningIcon.BorderSizePixel = 1
	scanningIcon.BorderColor3 = WIN95_COLORS.ButtonShadow
	scanningIcon.Text = "üì°"
	scanningIcon.TextColor3 = WIN95_COLORS.WindowText
	scanningIcon.Font = Enum.Font.SourceSans
	scanningIcon.TextSize = 24
	scanningIcon.Parent = content

	-- Progress bar container
	local progressContainer = Instance.new("Frame")
	progressContainer.Name = "ProgressContainer"
	progressContainer.Size = UDim2.new(1, -20, 0, 20)
	progressContainer.Position = UDim2.new(0, 10, 0, 70)
	progressContainer.BackgroundColor3 = WIN95_COLORS.ButtonShadow
	progressContainer.BorderSizePixel = 0
	progressContainer.Parent = content

	-- Progress bar fill
	local progressBar = Instance.new("Frame")
	progressBar.Name = "ProgressBar"
	progressBar.Size = UDim2.new(0, 0, 1, 0)
	progressBar.Position = UDim2.new(0, 0, 0, 0)
	progressBar.BackgroundColor3 = NOTIFICATION_COLORS.Info
	progressBar.BorderSizePixel = 0
	progressBar.Parent = progressContainer

	-- Status text
	local statusLabel = Instance.new("TextLabel")
	statusLabel.Name = "StatusLabel"
	statusLabel.Size = UDim2.new(1, -20, 0, 20)
	statusLabel.Position = UDim2.new(0, 10, 0, 100)
	statusLabel.BackgroundTransparency = 1
	statusLabel.Text = "–ê–Ω–∞–ª—ñ–∑ –ø–æ–≤–µ—Ä—Ö–Ω—ñ..."
	statusLabel.TextColor3 = WIN95_COLORS.WindowText
	statusLabel.Font = Enum.Font.SourceSans
	statusLabel.TextSize = 12
	statusLabel.Parent = content

	-- –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
	scanningWindow.Size = UDim2.new(0, 0, 0, 0)
	local tweenIn = TweenService:Create(scanningWindow, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 300, 0, 150)
	})
	tweenIn:Play()

	-- –ê–Ω—ñ–º–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–µ—Å –±–∞—Ä—É
	local progressTween = TweenService:Create(progressBar, TweenInfo.new(SCAN_DURATION, Enum.EasingStyle.Linear, Enum.EasingDirection.Out), {
		Size = UDim2.new(1, 0, 1, 0)
	})
	progressTween:Play()

	-- –ê–Ω—ñ–º–∞—Ü—ñ—è —ñ–∫–æ–Ω–∫–∏
	local rotationTween = TweenService:Create(scanningIcon, TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1), {
		Rotation = 360
	})
	rotationTween:Play()

	-- –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å —Ç–µ–∫—Å—Ç—É
	local statusMessages = {"–ê–Ω–∞–ª—ñ–∑ –ø–æ–≤–µ—Ä—Ö–Ω—ñ...", "–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ª—å—î—Ñ—É...", "–í–∏—è–≤–ª–µ–Ω–Ω—è –∞–Ω–æ–º–∞–ª—ñ–π...", "–û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö..."}
	for i, message in ipairs(statusMessages) do
		task.delay((i - 1) * (SCAN_DURATION / #statusMessages), function()
			if statusLabel and statusLabel.Parent then
				statusLabel.Text = message
			end
		end)
	end

	return scanningWindow
end

--============================================================================--
-- –ü–£–ë–õ–Ü–ß–ù–Ü –§–£–ù–ö–¶–Ü–á / PUBLIC API IMPLEMENTATION
--============================================================================--

--[[
@function Initialize
–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î UI –¥–ª—è –º–æ–¥–µ–ª—ñ —Å–∫–∞–Ω–µ—Ä–∞

@param scannerModel Model - –ú–æ–¥–µ–ª—å —Å–∫–∞–Ω–µ—Ä–∞ –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
@return nil
]]
function PlanetSurfaceScannerUI.Initialize(scannerModel: Model): nil
	print("[PlanetSurfaceScannerUI 2.0] üì° Initializing Scanner UI for model:", scannerModel.Name)

	-- –°—Ç–≤–æ—Ä—é—î–º–æ –≥–æ–ª–æ–≤–Ω–∏–π GUI
	scannerGui = Instance.new("ScreenGui")
	scannerGui.Name = "PlanetSurfaceScannerUI"
	scannerGui.ResetOnSpawn = false
	scannerGui.IgnoreGuiInset = true
	scannerGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	scannerGui.Parent = player:WaitForChild("PlayerGui")

	-- –ó–Ω–∞—Ö–æ–¥–∏–º–æ ScannerBaseplate
	local scannerBaseplate = scannerModel:FindFirstChild("ScannerBaseplate")
	if not scannerBaseplate then
		scannerBaseplate = scannerModel:WaitForChild("ScannerBaseplate", 5)
	end
	if not scannerBaseplate then
		scannerBaseplate = scannerModel:FindFirstChild("ScannerBaseplate", true)
	end
	if not scannerBaseplate then
		warn("[PlanetSurfaceScannerUI 2.0] ‚ö†Ô∏è ScannerBaseplate not found in scanner model")
		return
	end

	-- –ó–Ω–∞—Ö–æ–¥–∏–º–æ ProximityPrompt
	proximityPrompt = scannerBaseplate:FindFirstChild("ProximityPrompt")
	if not proximityPrompt then
		proximityPrompt = scannerBaseplate:WaitForChild("ProximityPrompt", 5)
	end
	if not proximityPrompt then
		proximityPrompt = scannerBaseplate:FindFirstChildWhichIsA("ProximityPrompt", true)
	end
	if not proximityPrompt then
		warn("[PlanetSurfaceScannerUI 2.0] ‚ö†Ô∏è ProximityPrompt not found in ScannerBaseplate")
		return
	end

	-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ ProximityPrompt


	proximityPrompt.Triggered:Connect(function(playerWhoTriggered)
		if playerWhoTriggered ~= player then return end
		if isScanning then return end

		print("[PlanetSurfaceScannerUI 2.0] üì° ProximityPrompt TRIGGERED by player:", playerWhoTriggered.Name)
		PlanetSurfaceScannerUI.ShowScanningAnimation()

		-- –û–Ω–æ–≤–ª—é—î–º–æ ScanLabel –Ω–∞ –¥–∏—Å–ø–ª–µ—ó —Å–∫–∞–Ω–µ—Ä–∞
		updateScannerDisplayPlanetName(lastPlanetName or "...")

		task.delay(SCAN_DURATION, function()
			PlanetSurfaceScannerUI.HideScanningAnimation()
			print("[PlanetSurfaceScannerUI 2.0] ‚úÖ Scan completed, waiting for server results")
		end)
	end)

	print("[PlanetSurfaceScannerUI 2.0] üéØ ProximityPrompt configured - Enabled:", proximityPrompt.Enabled, "MaxActivationDistance:", proximityPrompt.MaxActivationDistance)

	local scriptName = "PlanetSurfaceScannerUI"
	print(string.format("[%s %s] ‚úÖ Scanner UI initialized successfully", scriptName, scriptVersion))
end

--[[
@function ShowScanResults
–ü–æ–∫–∞–∑—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —É –≤—ñ–∫–Ω—ñ

@param results table - –¢–∞–±–ª–∏—Ü—è –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
@return nil
]]
function PlanetSurfaceScannerUI.ShowScanResults(results: {any}): nil
	print("[PlanetSurfaceScannerUI 2.0] üìä Showing scan results:", #results, "locations found")

	local resultsList = createResultsWindow()
	if not resultsList then return end

	-- –û—á–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
	for _, child in ipairs(resultsList:GetChildren()) do
		child:Destroy()
	end

	-- –°—Ç–≤–æ—Ä—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
	local yOffset = 5
	for i, result in ipairs(results) do
		if i > MAX_RESULTS then break end

		local resultFrame = Instance.new("Frame")
		resultFrame.Name = "Result" .. i
		resultFrame.Size = UDim2.new(1, -10, 0, 40)
		resultFrame.Position = UDim2.new(0, 5, 0, yOffset)
		resultFrame.BackgroundColor3 = WIN95_COLORS.WindowBackground
		resultFrame.BorderSizePixel = 1
		resultFrame.BorderColor3 = WIN95_COLORS.ButtonShadow
		resultFrame.Parent = resultsList

		-- –ù–∞–∑–≤–∞ –ª–æ–∫–∞—Ü—ñ—ó (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ DisplayName –∑ —Å–µ—Ä–≤–µ—Ä–∞)
		local locationName = result.DisplayName or "–ù–µ–≤—ñ–¥–æ–º–∞ –ª–æ–∫–∞—Ü—ñ—è"
		local nameLabel = Instance.new("TextLabel")
		nameLabel.Name = "NameLabel"
		nameLabel.Size = UDim2.new(0.7, -10, 1, -10)
		nameLabel.Position = UDim2.new(0, 5, 0, 5)
		nameLabel.BackgroundTransparency = 1
		nameLabel.Text = locationName
		nameLabel.TextColor3 = WIN95_COLORS.WindowText
		nameLabel.Font = Enum.Font.SourceSansBold
		nameLabel.TextSize = 14
		nameLabel.TextXAlignment = Enum.TextXAlignment.Left
		nameLabel.TextYAlignment = Enum.TextYAlignment.Center
		nameLabel.Parent = resultFrame

		-- –°—Ç–∞—Ç—É—Å "–ù–æ–≤–∞" —è–∫—â–æ –Ω–µ –≤—ñ–¥–≤—ñ–¥–∞–Ω–∞
		if not result.IsVisited then
			local statusLabel = Instance.new("TextLabel")
			statusLabel.Name = "StatusLabel"
			statusLabel.Size = UDim2.new(0, 60, 0, 20)
			statusLabel.Position = UDim2.new(1, -70, 0.5, -10)
			statusLabel.BackgroundColor3 = Color3.fromRGB(0, 150, 0) -- –ó–µ–ª–µ–Ω–∏–π
			statusLabel.BorderSizePixel = 1
			statusLabel.BorderColor3 = Color3.fromRGB(0, 100, 0)
			statusLabel.Text = "–ù–û–í–ê"
			statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
			statusLabel.Font = Enum.Font.SourceSansBold
			statusLabel.TextSize = 11
			statusLabel.Parent = resultFrame
		end

		yOffset = yOffset + 45
	end

	-- –û–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä ScrollingFrame
	resultsList.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

--[[
@function ShowScanningAnimation
–ü–æ–∫–∞–∑—É—î –∞–Ω—ñ–º–∞—Ü—ñ—é —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è

@return nil
]]
function PlanetSurfaceScannerUI.ShowScanningAnimation(): nil
	if isScanning then return end

	isScanning = true
	print("[PlanetSurfaceScannerUI 2.0] üì° Starting scanning animation...")
	createScanningWindow()
end

--[[
@function HideScanningAnimation
–•–æ–≤–∞—î –∞–Ω—ñ–º–∞—Ü—ñ—é —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è

@return nil
]]
function PlanetSurfaceScannerUI.HideScanningAnimation(): nil
	if not isScanning then return end

	isScanning = false
	print("[PlanetSurfaceScannerUI 2.0] ‚úÖ Hiding scanning animation...")

	if scanningWindow then
		local tweenOut = TweenService:Create(scanningWindow, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			Size = UDim2.new(0, 0, 0, 0)
		})
		tweenOut:Play()
		tweenOut.Completed:Wait()
		scanningWindow:Destroy()
		scanningWindow = nil
	end
end

--============================================================================--
-- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø / INITIALIZATION
--============================================================================--

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∞
task.spawn(function()
	-- –ß–µ–∫–∞—î–º–æ –ø–æ–∫–∏ LocationModel –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ
	local locationModel = game.Workspace:WaitForChild("LocationModel", 30)
	if locationModel then
		-- –í–∞–ª—ñ–¥—É—î–º–æ —â–æ —Ü–µ SpaceStation LocationModel
		local locationId = locationModel:GetAttribute("LocationId")
		local locationType = locationModel:GetAttribute("LocationType")
		
		if locationId == "SpaceStation" and locationType == "Space" then
			-- –®—É–∫–∞—î–º–æ PlanetSurfaceScanner –≤ Equipment —Å–µ–∫—Ü—ñ—ó
			local equipmentFolder = locationModel:FindFirstChild("Equipment")
			if equipmentFolder then
				local scannerModel = equipmentFolder:WaitForChild("PlanetSurfaceScanner", 10)
				if scannerModel then
					PlanetSurfaceScannerUI.Initialize(scannerModel)
					local scriptName = "PlanetSurfaceScannerUI"
					print(string.format("[%s %s] ‚úÖ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è LocationModel.Equipment.PlanetSurfaceScanner", scriptName, scriptVersion))
				else
					warn("[PlanetSurfaceScannerUI 2.0] ‚ö†Ô∏è PlanetSurfaceScanner –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ LocationModel/Equipment")
				end
			else
				warn("[PlanetSurfaceScannerUI 2.0] ‚ö†Ô∏è Equipment –ø–∞–ø–∫–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞ –≤ LocationModel")
			end
		else
			warn("[PlanetSurfaceScannerUI 2.0] ‚ö†Ô∏è LocationModel –º–∞—î –Ω–µ–≤—ñ—Ä–Ω—ñ attributes:")
			warn("  ‚îî‚îÄ LocationId: " .. tostring(locationId) .. " (expected: SpaceStation)")
			warn("  ‚îî‚îÄ LocationType: " .. tostring(locationType) .. " (expected: Space)")
		end
	else
		warn("[PlanetSurfaceScannerUI 2.0] ‚ö†Ô∏è LocationModel –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ Workspace")
		warn("  ‚îî‚îÄ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ SpaceStation –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —á–µ—Ä–µ–∑ EnvironmentLoader")
	end
end)

-- –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
_G.PlanetSurfaceScannerUI = PlanetSurfaceScannerUI

return PlanetSurfaceScannerUI